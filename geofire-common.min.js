!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self)["geofire-common"]={})}(this,function(t){"use strict";var c=10,g="0123456789bcdefghjkmnpqrstuvwxyz",e=40007860,u=110574,s=5,f=22*s,o=6378137,a=.00669447819799,i=1e-12;function r(t){return Math.log(t)/Math.log(2)}function m(t){var e,n,r;if(Array.isArray(t)?2!==t.length?e="expected array of length 2, got length "+t.length:(n=t[0],r=t[1],"number"!=typeof n||isNaN(n)?e="latitude must be a number":n<-90||90<n?e="latitude must be within the range [-90, 90]":"number"!=typeof r||isNaN(r)?e="longitude must be a number":(r<-180||180<r)&&(e="longitude must be within the range [-180, 180]")):e="location must be an array",void 0!==e)throw new Error("Invalid GeoFire location '"+t+"': "+e)}function l(t){var e;if("string"!=typeof t)e="geohash must be a string";else if(0===t.length)e="geohash cannot be the empty string";else for(var n=0,r=t;n<r.length;n++){var o=r[n];-1===g.indexOf(o)&&(e="geohash cannot contain '"+o+"'")}if(void 0!==e)throw new Error("Invalid GeoFire geohash '"+t+"': "+e)}function h(t){if("number"!=typeof t||isNaN(t))throw new Error("Error: degrees must be a number");return t*Math.PI/180}function d(t,e){if(void 0===e&&(e=c),m(t),void 0!==e){if("number"!=typeof e||isNaN(e))throw new Error("precision must be a number");if(e<=0)throw new Error("precision must be greater than 0");if(22<e)throw new Error("precision cannot be greater than 22");if(Math.round(e)!==e)throw new Error("precision must be an integer")}for(var n={min:-90,max:90},r={min:-180,max:180},o="",a=0,i=0,h=1;o.length<e;){var u=h?t[1]:t[0],s=h?r:n,f=(s.min+s.max)/2;f<u?(a=1+(a<<1),s.min=f):(a<<=1,s.max=f),h=!h,i<4?i++:(i=0,o+=g[a],a=0)}return o}function M(t,e){var n=h(e),r=Math.cos(n)*o*Math.PI/180*(1/Math.sqrt(1-a*Math.sin(n)*Math.sin(n)));return r<i?0<t?360:0:Math.min(360,t/r)}function b(t,e){var n=M(t,e);return 1e-6<Math.abs(n)?Math.max(1,r(360/n)):1}function v(t){return Math.min(r(e/2/t),f)}function E(t){if(t<=180&&-180<=t)return t;var e=t+180;return 0<e?e%360-180:180- -e%360}function y(t,e){var n=e/u,r=Math.min(90,t[0]+n),o=Math.max(-90,t[0]-n),a=2*Math.floor(v(e)),i=2*Math.floor(b(e,r))-1,h=2*Math.floor(b(e,o))-1;return Math.min(a,i,h,f)}function p(t,e){var n=e/u,r=Math.min(90,t[0]+n),o=Math.max(-90,t[0]-n),a=M(e,r),i=M(e,o),h=Math.max(a,i);return[[t[0],t[1]],[t[0],E(t[1]-h)],[t[0],E(t[1]+h)],[r,t[1]],[r,E(t[1]-h)],[r,E(t[1]+h)],[o,t[1]],[o,E(t[1]-h)],[o,E(t[1]+h)]]}function w(t,e){l(t);var n=Math.ceil(e/s);if(t.length<n)return[t,t+"~"];var r=(t=t.substring(0,n)).substring(0,t.length-1),o=g.indexOf(t.charAt(t.length-1)),a=e-r.length*s,i=s-a,h=o>>i<<i,u=h+(1<<i);return 31<u?[r+g[h],r+"~"]:[r+g[h],r+g[u]]}t.BASE32=g,t.BITS_PER_CHAR=s,t.E2=a,t.EARTH_EQ_RADIUS=o,t.EARTH_MERI_CIRCUMFERENCE=e,t.EPSILON=i,t.GEOHASH_PRECISION=c,t.MAXIMUM_BITS_PRECISION=f,t.METERS_PER_DEGREE_LATITUDE=u,t.boundingBoxBits=y,t.boundingBoxCoordinates=p,t.degreesToRadians=h,t.distanceBetween=function(t,e){m(t),m(e);var n=h(e[0]-t[0]),r=h(e[1]-t[1]),o=Math.sin(n/2)*Math.sin(n/2)+Math.cos(h(t[0]))*Math.cos(h(e[0]))*Math.sin(r/2)*Math.sin(r/2);return 6371*(2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o)))},t.geohashForLocation=d,t.geohashQuery=w,t.geohashQueryBounds=function(t,e){m(t);var n=Math.max(1,y(t,e)),r=Math.ceil(n/s),o=p(t,e).map(function(t){return w(d(t,r),n)});return o.filter(function(n,r){return!o.some(function(t,e){return e<r&&n[0]===t[0]&&n[1]===t[1]})})},t.latitudeBitsForResolution=v,t.longitudeBitsForResolution=b,t.metersToLongitudeDegrees=M,t.validateGeohash=l,t.validateKey=function(t){var e;if("string"!=typeof t?e="key must be a string":0===t.length?e="key cannot be the empty string":755<1+c+t.length?e="key is too long to be stored in Firebase":/[\[\].#$\/\u0000-\u001F\u007F]/.test(t)&&(e="key cannot contain any of the following characters: . # $ ] [ /"),void 0!==e)throw new Error("Invalid GeoFire key '"+t+"': "+e)},t.validateLocation=m,t.wrapLongitude=E,Object.defineProperty(t,"__esModule",{value:!0})});
